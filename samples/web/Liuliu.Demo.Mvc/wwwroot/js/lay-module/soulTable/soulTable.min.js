/**
 *
 * @name:  表格增强插件
 * @author: yelog
 * @link: https://github.com/yelog/layui-soul-table
 * @license: MIT
 * @version: v1.5.16
 */
layui.define(["table","tableFilter","tableChild","tableMerge"],function(n){var u=layui.tableFilter,c=layui.tableChild,l=layui.tableMerge,t=layui.$,r=layui.table,e="layui-hide",o={},f={},s={fixTotal:!1,drag:!0,rowDrag:!1,autoColumnWidth:!0,contextmenu:!1,fixResize:!0,overflow:!1,fixFixedScroll:!0,filter:!1},i=t("body"),h=t(document),a={render:function(n){var i,r,e,h;o[n.id]=n;i=t.extend({},s,n);i.filter&&i.filter.cache?(r=location.pathname+location.hash+n.id,e=this.deepStringify(n.cols),f[n.id]||(f[n.id]=this.deepClone(n.cols),h=localStorage.getItem(r),h&&e===localStorage.getItem("origin"+r)?this.updateCols(n,this.deepParse(h)):(localStorage.setItem("origin"+r,e),localStorage.removeItem(r)))):this.clearCache(n);u.render(n);c.render(n);l.render(n);i.fixTotal&&this.fixTotal(n);i.drag&&this.drag(n,i.drag);i.rowDrag&&this.rowDrag(n,i.rowDrag);i.autoColumnWidth&&this.autoColumnWidth(n,i.autoColumnWidth);this.contextmenu(n,i.contextmenu);i.fixResize&&this.fixResizeRightFixed(n);i.overflow&&this.overflow(n,i.overflow);i.fixFixedScroll&&this.fixFixedScroll(n)},config:function(n){typeof n=="object"&&t.extend(!0,s,n)},updateCols:function(n,i){function y(r,u){var o,h;for(f=0;f<i.length;f++)for(e=0;e<i[f].length;e++)s=n.index+"-"+i[f][e].key,o=t(r).children(u+":eq("+e+")").attr("data-key"),o!==s&&(t(r).children(u+":eq("+e+")").before(t(r).children(u+'[data-key="'+s+'"]')),i[f][e].fixed&&(h=(u==="th"?a:v).children().children(u==="th"?"tr":'tr[data-index="'+t(r).attr("data-index")+'"]'),h.children(u+'[data-key="'+o+'"]').before(h.children(u+'[data-key="'+s+'"]'))))}for(var e,o={},s,l=[],c=[],p=t(n.elem),h=p.next().children(".layui-table-box"),a=h.children(".layui-table-fixed").children(".layui-table-header").children("table"),w=t.merge(h.children(".layui-table-header").children("table"),a),b=h.children(".layui-table-header").children("table"),v=h.children(".layui-table-fixed").children(".layui-table-body").children("table"),k=h.children(".layui-table-body").children("table"),d=t.merge(h.children(".layui-table-body").children("table"),v),f=0;f<n.cols.length;f++)for(e=0;e<n.cols[f].length;e++)n.cols[f][e].oldPos=f+"-"+e,o[n.cols[f][e].key]=n.cols[f][e];for(f=0;f<i.length;f++){for(c=[],e=0;e<i[f].length;e++){if(s=n.index+"-"+i[f][e].key,i[f][e].width&&o[i[f][e].key]!==i[f][e].width&&this.getCssRule(n,s,function(n){n.style.width=(i[f][e].width?i[f][e].width:0)+"px"}),o[i[f][e].key].hide!==i[f][e].hide&&(w.find('th[data-key="'+s+'"]')[i[f][e].hide?"addClass":"removeClass"]("layui-hide"),d.find('td[data-key="'+s+'"]')[i[f][e].hide?"addClass":"removeClass"]("layui-hide")),(o[i[f][e].key].oldPos!==f+"-"+e||o[i[f][e].key].fixed!==i[f][e].fixed)&&i[f][e].fixed!==o[i[f][e].key].fixed){n.cols=i;r.reload(n.id);return}o[i[f][e].key].fixed=i[f][e].fixed;o[i[f][e].key].width=i[f][e].width;o[i[f][e].key].hide=i[f][e].hide;c.push(o[i[f][e].key])}l.push(c)}b.children().children("tr").each(function(){y(this,"th")});k.children().children("tr").each(function(){y(this,"td")});n.cols=l;u.resize(n)},"export":function(n,t){u.export(n.config||n,t)},getCssRule:function(n,t,i){var r=n.elem.next().find("style")[0],u=r.sheet||r.styleSheet||{},f=u.cssRules||u.rules;layui.each(f,function(n,r){if(r.selectorText===".laytable-cell-"+t)return i(r),!0})},autoColumnWidth:function(n,r){function f(n,u){function h(i,r,u){var h=r.data("key"),a=h.split("-"),y=a.length===3?a[1]+"-"+a[2]:"",f,l,v,e,o;if(!(r.attr("colspan")>1)&&!r.data("unresize")&&u)for(f=r.text().width(r.css("font"))+21,l=r.css("font"),c.children('td[data-key="'+h+'"]').each(function(){var n=0;t(this).children().children()&&t(this).children().children().length>0?n+=t(this).children().html().width(l):n=t(this).text().width(l);f<n&&(f=n)}),s.length>0&&(v=s.children('td[data-key="'+h+'"]').text().width(l),f<v&&(f=v)),f+=32,n.getCssRule(i,h,function(n){n.style.width=f+"px"}),e=0;e<i.cols.length;e++)for(o=0;o<i.cols[e].length;o++)if(i.cols[e][o].key===y){i.cols[e][o].width=f;break}}var f=t(u.elem),e=f.next().children(".layui-table-box").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),o=f.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),c=f.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr"),s=f.next().children(".layui-table-total").find("tr");if(String.prototype.width=function(n){var u=n||i.css("font"),r=t("<div>"+this+"<\/div>").css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:u}).appendTo(i),f=r.width();return r.remove(),f},typeof r=="undefined"||typeof r.dblclick=="undefined"||r.dblclick)e.add(o).on("dblclick",function(n){var i=t(this),r=n.clientX-i.offset().left;h(u,i,i.parents(".layui-table-fixed-r").length>0?r<=10:i.width()-r<=10)});r&&r.init&&e.add(o).each(function(){var n=t(this).attr("data-key").split("-");u.cols[n[1]][n[2]].autoWidth===!1||Array.isArray(r.init)&&r.init.indexOf(t(this).attr("data-field"))===-1||h(u,t(this),!0)})}var u=this;typeof n=="object"?f(u,n):typeof n=="string"?f(u,o[n]):typeof n=="undefined"&&layui.each(o,function(){f(u,this)})},drag:function(n,f){var c;if(!(n.cols.length>1)){var v=this,y=t(n.elem),o=y.next().children(".layui-table-box"),p=t.merge(o.children(".layui-table-header").children("table"),o.children(".layui-table-fixed").children(".layui-table-header").children("table")),k=o.children(".layui-table-fixed").children(".layui-table-body").children("table"),tt=o.children(".layui-table-body").children("table"),l=t.merge(o.children(".layui-table-body").children("table"),k),s=y.next().children(".layui-table-total").children("table"),g=y.next().children(".layui-table-total").children("table.layui-table-total-fixed"),it=y.next().children(".layui-table-total").children("table:eq(0)"),a=n.id,nt=f==="simple"||f&&f.type==="simple",d=f&&f.toolbar,w=!1,b=!1;if(!p.attr("drag")){if(p.attr("drag",!0),d){o.append('<div class="soul-drag-bar"><div data-type="left">左固定<\/div><div data-type="none">不固定<\/div><div data-type="right">右固定<\/div><\/div>');c=o.children(".soul-drag-bar");c.children("div").on("mouseenter",function(){t(this).addClass("active")}).on("mouseleave",function(){t(this).removeClass("active")})}p.find("th").each(function(){var f=t(this),rt=f.data("field"),y=f.data("key");if(y){var ft=y.split("-"),ut=n.cols[ft[1]][ft[2]],et=ft[1]+"-"+ft[2],ot=f.parents(".layui-table-fixed").length>0;t(this).find("span:first,.laytable-cell-checkbox").css("cursor","move").on("mousedown",function(ft){if(ft.button===0){ft.preventDefault();var st=f.clone().css("visibility","hidden"),vt=f.position().left,lt=f.offset().top,yt=ft.clientX-vt,pt=f.parents("tr:eq(0)").css("background-color"),ct=f.width(),wt=0,at=t(this),ht=ut.fixed;b=!0;h.bind("selectstart",function(){return!1});i.on("mousemove",function(r){if(b&&st){o.removeClass("no-left-border");w||(d&&(c.attr("data-type",ht||"none"),c.addClass("active")),f.after(st),f.addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":pt,width:ct+1}),nt||((ot?k:l).find('td[data-key="'+y+'"]').each(function(){t(this).after(t(this).clone().css("visibility","hidden").attr("data-clone",""));t(this).addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":t(this).css("background-color"),width:ct+1})}),s.length>0&&(ot?g:s).find('td[data-key="'+y+'"]').each(function(){t(this).after(t(this).clone().css("visibility","hidden").attr("data-clone",""));t(this).addClass("isDrag").css({position:"absolute","z-index":1,"background-color":t(this).parents("tr:eq(0)").css("background-color"),width:ct+1})})));w=!0;var u,e,h,p,it,tt=r.clientX-yt,ut=st.prev().prev(),at=ut.length>0,dt=at?ut.data("key").split("-"):[],ft=st.next().hasClass("layui-table-patch")?[]:st.next(),vt=ft.length>0,gt=vt?ft.data("key").split("-"):[],bt=at&&st.position().left-tt>ut.width()/2,kt=vt&&tt-st.position().left>ft.width()/2;if(wt=Math.abs(st.position().left-tt),st.position().left-tt>0?!at||!!ht!=!!n.cols[dt[1]][dt[2]].fixed:!vt||!!ht!=!!n.cols[gt[1]][gt[2]].fixed){f.css("left",st.position().left);l.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().css("left",st.position().left)});s.length>0&&s.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().css("left",st.position().left)});o.addClass("no-left-border");return}if(f.css("left",tt),bt){for(st.after(ut),t("#soul-columns"+a+'>li[data-value="'+rt+'"]').after(t("#soul-columns"+a+'>li[data-value="'+rt+'"]').prev()),h=0;h<n.cols.length;h++){for(p=0;p<n.cols[h].length;p++)if(n.cols[h][p].key===et){u=h;e=p;break}if(typeof u!="undefined"&&typeof e!="undefined")break}it=n.cols[u][e-1];n.cols[u][e-1]=n.cols[u][e];n.cols[u][e]=it;v.fixTableRemember(n)}else if(kt){for(st.prev().before(ft),t("#soul-columns"+a+'>li[data-value="'+rt+'"]').before(t("#soul-columns"+a+'>li[data-value="'+rt+'"]').next()),h=0;h<n.cols.length;h++){for(p=0;p<n.cols[h].length;p++)if(n.cols[h][p].key===et){u=h;e=p;break}if(typeof u!="undefined"&&typeof e!="undefined")break}it=n.cols[u][e+1];n.cols[u][e+1]=n.cols[u][e];n.cols[u][e]=it;v.fixTableRemember(n)}l.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().css("left",tt);bt?t(this).prev().prev().length!==0&&t(this).after(t(this).prev().prev()):kt&&t(this).next().length!==0&&t(this).prev().before(t(this).next())});s.length>0&&s.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().css("left",tt);bt?t(this).prev().prev().length!==0&&t(this).after(t(this).prev().prev()):kt&&t(this).next().length!==0&&t(this).prev().before(t(this).next())});r.clientY-lt<-15?(t("#column-remove").length===0&&i.append('<i id="column-remove" class="layui-red layui-icon layui-icon-delete"><\/i>'),t("#column-remove").css({top:r.clientY-t("#column-remove").height()/2,left:r.clientX-t("#column-remove").width()/2,"font-size":lt-r.clientY+"px"}),t("#column-remove").show()):t("#column-remove").hide()}}).on("mouseup",function(){var lt,yt,pt,ft,ct,wt,vt;if(h.unbind("selectstart"),i.off("mousemove").off("mouseup"),b&&st){if(b=!1,w){if(ut.type!=="checkbox")at.on("click",function(n){n.stopPropagation()});if(w=!1,o.removeClass("no-left-border"),f.removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),f.next().remove(),lt=f.prev().data("key"),ht&&(yt=o.children(".layui-table-header").children("table").find('th[data-key="'+y+'"]'),lt?yt.parent().children('th[data-key="'+lt+'"]').after(yt):ht==="right"?f.siblings().length>0&&o.children(".layui-table-header").children("table").find('th[data-key="'+f.next().data("key")+'"]').prev().after(yt):(yt.parent().prepend('<th class="layui-hide"><\/th>'),yt.parent().children("th:first").after(yt),yt.parent().children("th:first").remove())),nt?(l.find('td[data-key="'+y+'"]').each(function(){if(lt)t(this).parent().children('td[data-key="'+lt+'"]').after(t(this));else if(ht==="right"){if(f.siblings().length>0){var n=t(this).parent().children('td[data-key="'+f.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()}),s.length>0&&s.find('td[data-key="'+y+'"]').each(function(){if(lt)t(this).parent().children('td[data-key="'+lt+'"]').after(t(this));else if(ht==="right"){var n=t(this).parent().children('td[data-key="'+f.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()})):ot?(tt.find('td[data-key="'+y+'"]').each(function(){if(lt)t(this).parent().children('td[data-key="'+lt+'"]').after(t(this));else if(ht==="right"){if(f.siblings().length>0){var n=t(this).parent().children('td[data-key="'+f.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()}),k.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"});t(this).remove()}),s.length>0&&(it.find('td[data-key="'+y+'"]').each(function(){if(lt)t(this).parent().children('td[data-key="'+lt+'"]').after(t(this));else if(ht==="right"){var n=t(this).parent().children('td[data-key="'+f.next().data("key")+'"]').prev();n.length>0?n.after(t(this)):(t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove())}else t(this).parent().prepend('<td class="layui-hide"><\/td>'),t(this).parent().children("td:first").after(t(this)),t(this).parent().children("td:first").remove()}),g.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"});t(this).remove()}))):(l.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"});t(this).remove()}),s.length>0&&s.find('td[data-key="'+y+'"][data-clone]').each(function(){t(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"});t(this).remove()})),st=null,d){if(c.children(".active").length>0&&c.children(".active").attr("data-type")!==c.attr("data-type")){for(pt=c.children(".active").attr("data-type"),ft=0;ft<n.cols.length;ft++)for(ct=0;ct<n.cols[ft].length;ct++)pt==="right"||pt==="none"&&c.attr("data-type")==="right"?typeof vt=="undefined"&&(n.cols[ft][ct].fixed==="right"?vt={x:ft,y:ct}:ct===n.cols[ft].length-1&&(vt={x:ft,y:ct+1})):typeof vt!="undefined"||n.cols[ft][ct].fixed&&n.cols[ft][ct].fixed!=="right"||(vt={x:ft,y:ct}),n.cols[ft][ct].key===et&&(wt={x:ft,y:ct});ut.fixed=pt==="none"?!1:pt;wt.y!==vt.y&&(n.cols[wt.x].splice(wt.y,1),wt.y<vt.y&&(vt.y-=1),n.cols[vt.x].splice(vt.y,0,ut),v.fixTableRemember(n));r.reload(a)}c.removeClass("active")}}else at.unbind("click");t("#column-remove").is(":visible")&&(p.find("thead>tr>th[data-key="+y+"]").addClass(e),l.find('tbody>tr>td[data-key="'+y+'"]').addClass(e),s.find('tbody>tr>td[data-key="'+y+'"]').addClass(e),ut.hide=!0,v.fixTableRemember(n),t("#soul-columns"+a).find('li[data-value="'+rt+'"]>input').prop("checked",!1),u.resize(n));t("#column-remove").hide()}})}})}})}}},rowDrag:function(n,u){var p=this,l=t(n.elem),e=l.next().children(".layui-table-box"),a=e.children(".layui-table-fixed").children(".layui-table-body").children("table"),v=e.children(".layui-table-body").children("table"),y=t.merge(e.children(".layui-table-body").children("table"),a),b=n.id,c=!1,o=u.trigger||"row",k=u.numbers!==!1,s=null,w=0,d=o==="row"?y.children("tbody").children("tr"):y.find(o),f,h;for(o!=="row"&&y.find(o).css("cursor","move"),f=0;f<n.cols.length;f++)for(h=0;h<n.cols[f].length;h++)if(n.cols[f][h].type==="numbers"){s=n.index+"-"+f+"-"+h;w=parseInt(v.find('td[data-key="'+s+'"]:first').text());break}d.on("mousedown",function(h){if(h.button===0){var tt=o==="row"?t(this):t(this).parents("tr:eq(0)"),d=parseInt(tt.data("index")),y=v.children("tbody").children("tr[data-index="+d+"]"),nt=y.clone().css("visibility","hidden"),g=a.children("tbody").children("tr[data-index="+d+"]"),it=e.children(".layui-table-body").scrollTop(),rt=tt.position().top,ut=h.clientY-rt;i.on("mousemove",function(n){function i(n,t){var i=parseInt(n.data("index"))+t;return n.data("index",i),n.attr("data-index",i),n}var f,o;c||(c=!0,f=l.next().find("style")[0],o=f.sheet||f.styleSheet||{},p.addCSSRule(o,".layui-table-view .layui-table td","cursor: move"),p.addCSSRule(o,".layui-table tr","transition: none"),e.addClass("noselect"),y.after(nt),y.css({position:"absolute","z-index":1}),g.each(function(){t(this).after(t(this).clone().css("visibility","hidden"));t(this).css({position:"absolute","z-index":102})}));var r=n.clientY-ut+(e.children(".layui-table-body").scrollTop()-it),u=nt.position().top,s=y.prev(),a=s.length>0,h=nt.next(),v=h.length>0,w=a&&u-r>s.height()/2,b=v&&r-u>h.height()/2;if(u-r>0?!a:!v){y.css("top",u);g.each(function(){t(this).css("top",u)});return}y.css("top",r);g.each(function(){t(this).css("top",r)});w?(i(y,-1),nt.after(i(s,1)),g.each(function(){i(t(this),-1);t(this).next().after(i(t(this).prev(),1))})):b&&(i(y,1).before(i(h,-1)),g.each(function(){i(t(this),1);t(this).before(i(t(this).next().next(),-1))}))}).on("mouseup",function(){var o,h,nt,it,p;if(i.off("mousemove").off("mouseup"),c){c=!1;e.removeClass("noselect");y.css({position:"inherit","z-index":"inherit"});y.next().remove();g.each(function(){t(this).css({position:"inherit","z-index":"inherit"});t(this).next().remove()});var rt=l.next().find("style")[0],ut=rt.sheet||rt.styleSheet||{},ft=ut.cssRules||ut.rules;if(layui.each(ft,function(n,t){t.selectorText===".layui-table-view .layui-table td"&&(t.style.cursor="default")}),o=tt.index(),o!==d){if(h=r.cache[b],nt=h.splice(d,1)[0],h.splice(o,0,nt),s&&k)for(it=[o,d].sort(),f=it[0];f<=it[1];f++)p=w+f,a.find('td[data-key="'+s+'"]:eq('+f+")").children().html(p),v.find('td[data-key="'+s+'"]:eq('+f+")").children().html(p),h[f][r.config.indexName]=p-1;typeof u.done=="function"&&u.done.call(n,{row:nt,newIndex:o,oldIndex:d,cache:h})}}})}})},fixTableRemember:function(n,t){var u,i,r,f;if(typeof n.filter=="undefined"?s.filter&&s.filter.cache:n.filter.cache){if(t&&t.rule)for(u=t.rule.selectorText.split("-")[3]+"-"+t.rule.selectorText.split("-")[4],i=0;i<n.cols.length;i++)for(r=0;r<n.cols[i].length;r++)if(n.cols[i][r].key===u){n.cols[i][r].width=t.rule.style.width.replace("px","");break}f=location.pathname+location.hash+n.id;localStorage.setItem(f,this.deepStringify(n.cols))}},clearCache:function(n){if(n){var t;t=typeof n=="object"?typeof n.config!="undefined"?n.config.id:n.id:n;localStorage.removeItem(location.pathname+location.hash+t);f[t]&&this.updateCols(o[t],this.deepClone(f[t]))}},overflow:function(n,i){var r={};if(typeof i=="string")r={type:i};else if(typeof i=="object")r=i;else return;var e=t(n.elem),s=e.next().find(".layui-table-header"),h=e.next().find(".layui-table-body"),c=e.next().find(".layui-table-total"),l,o=r.hoverTime||0,f,y=r.color||"white",p=r.bgColor||"black",a=r.minWidth||300,v=r.maxWidth||300;if(r.type==="tips"){h.off("mouseenter","td").off("mouseleave","td").on("mouseenter","td",function(){var n=this;f=setTimeout(function(){u.call(n)},o)}).on("mouseleave","td",function(){u.call(this,"hide")});if(r.header)s.off("mouseenter","th").off("mouseleave","th").on("mouseenter","th",function(){var n=this;f=setTimeout(function(){u.call(n)},o)}).on("mouseleave","th",function(){u.call(this,"hide")});if(r.total)c.off("mouseenter","td").off("mouseleave","td").on("mouseenter","td",function(){var n=this;f=setTimeout(function(){u.call(n)},o)}).on("mouseleave","td",function(){u.call(this,"hide")});function u(n){clearTimeout(f);var r=t(this),u=r.children(".layui-table-cell"),i=u.outerWidth(),e=i<a?a:i>v?v:i;r.data("off")||(n?layer.close(l):u.prop("scrollWidth")>i&&(l=layer.tips('<span style="color: '+y+'">'+t(this).text()+"<\/span>",this,{tips:[1,p],maxWidth:e,time:0})))}}else if(r.type==="title"){h.off("mouseenter","td").on("mouseenter","td",function(){var i=t(this),n=i.children(".layui-table-cell");i.data("off")||n.prop("scrollWidth")>n.outerWidth()&&n.attr("title",t(this).text())});if(r.header)s.off("mouseenter","th").on("mouseenter","th",function(){var i=t(this),n=i.children(".layui-table-cell");i.data("off")||n.prop("scrollWidth")>n.outerWidth()&&n.attr("title",t(this).text())});if(r.total)c.off("mouseenter","td").on("mouseenter","td",function(){var i=t(this),n=i.children(".layui-table-cell");i.data("off")||n.prop("scrollWidth")>n.outerWidth()&&n.attr("title",t(this).text())})}},contextmenu:function(n,u){function c(u,f,e,o,s,l,a,v){var w=[],y,p;for(w.push('<ul class="soul-table-contextmenu">'),y=0;y<o.length;y++)w.push('<li data-index="'+y+'" class="'+(o[y].children&&o[y].children.length>0?"contextmenu-children":"")+'">'),o[y].icon?w.push('<i class="prefixIcon '+o[y].icon+'" />'):w.push('<i class="prefixIcon" />'),w.push(o[y].name),o[y].children&&o[y].children.length>0&&w.push('<i class="endIcon layui-icon layui-icon-right" />'),w.push("<\/li>");for(w.push("<\/ul>"),u.append(w.join("")),p=u.children().last(),e+p.outerHeight()>i.prop("scrollHeight")&&(e=e-p.outerHeight(),e<0&&(e=0)),u.parent().data("direction")==="left"&&u.offset().left-p.outerWidth()>0?(f=-p.outerWidth(),p.data("direction","left")):f+p.outerWidth()+u.offset().left>i.prop("scrollWidth")&&(f=f-p.outerWidth()-u.outerWidth(),f+u.offset().left<0&&(f=-u.offset().left),p.data("direction","left")),p.css({top:e+"px",left:f+"px"}),y=0;y<o.length;y++)typeof o[y].click=="function"&&function(i){u.children(".soul-table-contextmenu:last").children('li[data-index="'+i+'"]').on("click",function(){var u=s.parents("tr:eq(0)").data("index"),e=l.find('tr[data-index="'+u+'"]'),f=layui.table.cache[h][u];o[i].click.call(n,{cell:s,elem:a==="th"?s:v?l.children("tbody").children('tr[data-index="'+u+'"]').children('[data-key="'+s.data("key")+'"]'):l.find('[data-key="'+s.data("key")+'"]'),trElem:l.children("tbody").children('tr[data-index="'+u+'"]'),text:s.text(),field:s.data("field"),del:v?function(){r.cache[h][u]=[];e.remove();r.resize(h)}:"",update:v?function(n){n=n||{};layui.each(n,function(n,i){if(n in f){var u,o=e.children('td[data-field="'+n+'"]');f[n]=i;r.eachCols(h,function(t,i){i.field==n&&i.templet&&(u=i.templet)});o.children(".layui-table-cell").html(function(){return u?function(){return typeof u=="function"?u(f):layui.laytpl(t(u).html()||i).render(f)}():i}());o.data("content",i)}})}:"",row:v?f:{}});t("#soul-table-contextmenu-wrapper").remove()})}(y);u.children(".soul-table-contextmenu:last").children("li").on("mouseenter",function(n){n.stopPropagation();t(this).siblings(".contextmenu-children").children("ul").remove();t(this).hasClass("contextmenu-children")&&c(t(this),t(this).outerWidth(),t(this).position().top,o[t(this).data("index")].children,s,l,a,v)})}for(var o,v,l=t(n.elem),s=l.next().children(".layui-table-box"),y=t.merge(s.children(".layui-table-header").children("table"),s.children(".layui-table-fixed").children(".layui-table-header").children("table")),p=s.children(".layui-table-fixed").children(".layui-table-body").children("table"),w=t.merge(s.children(".layui-table-body").children("table"),p),b=l.next().children(".layui-table-total").children("table"),h=n.id,k=u?u.header:"",d=u?u.body:"",g=u?u.total:"",f={header:{box:y,tag:"th",opts:k,cols:{}},body:{box:w,tag:"td",opts:d,cols:{},isBody:!0},total:{box:b,tag:"td",opts:g,cols:{}}},a=!1,e=0;e<n.cols.length;e++)for(o=0;o<n.cols[e].length;o++)n.cols[e][o].contextmenu&&(a=!0,f.header.cols[n.cols[e][o].key]=n.cols[e][o].contextmenu.header,f.body.cols[n.cols[e][o].key]=n.cols[e][o].contextmenu.body,f.total.cols[n.cols[e][o].key]=n.cols[e][o].contextmenu.total);if(u||a){for(v in f)(function(n){f[n].box.find(f[n].tag).on("contextmenu",function(r){t("#soul-table-contextmenu-wrapper").remove();i.append('<div id="soul-table-contextmenu-wrapper"><\/div>');t("#soul-table-contextmenu-wrapper").on("click",function(n){n.stopPropagation()});var u=f[n].cols[t(this).data("key").substr(t(this).data("key").indexOf("-")+1)];return u===!1?!1:u&&u.length>0?(c(t("#soul-table-contextmenu-wrapper"),r.pageX,r.pageY,u,t(this),f[n].box,f[n].tag,f[n].isBody),!1):f[n].opts===!1?!1:f[n].opts&&f[n].opts.length>0?(c(t("#soul-table-contextmenu-wrapper"),r.pageX,r.pageY,f[n].opts,t(this),f[n].box,f[n].tag,f[n].isBody),!1):void 0})})(v);i.on("click",function(){t("#soul-table-contextmenu-wrapper").remove()})}},fixTotal:function(n){var u=t(n.elem),r=u.next().children(".layui-table-total"),e=u.next().find("style")[0],f=e.sheet||e.styleSheet||{};if(r.length>0){var o=u.next().children(".layui-table-box"),s=o.children(".layui-table-fixed-l").children(".layui-table-body").children("table").children("tbody").children("tr:eq(0)").children("td"),h=o.children(".layui-table-fixed-r").children(".layui-table-body").children("table").children("tbody").children("tr:eq(0)").children("td"),i=[];r.children(".layui-table-total-fixed").remove();s.length>0&&(this.addCSSRule(f,".layui-table-total-fixed-l .layui-table-patch","display: none"),u.next().css("position","relative"),i.push('<table style="position: absolute;background-color: #fff;left: 0;top: '+(r.position().top+1)+'px" cellspacing="0" cellpadding="0" border="0" class="layui-table layui-table-total-fixed layui-table-total-fixed-l"><tbody><tr>'),s.each(function(){t(this).data("key")&&i.push(r.children("table:eq(0)").find('[data-key="'+t(this).data("key")+'"]').prop("outerHTML"))}),i.push("<\/tr><\/tbody><\/table>"),r.append(i.join("")));h.length>0&&(this.addCSSRule(f,".layui-table-total-fixed-r td:first-child","border-left:1px solid #e6e6e6"),this.addCSSRule(f,".layui-table-total-fixed-r td:last-child","border-left: none"),u.next().css("position","relative"),i=[],i.push('<table style="position: absolute;background-color: #fff;right: 0;top: '+(r.position().top+1)+'px" cellspacing="0" cellpadding="0" border="0" class="layui-table layui-table-total-fixed layui-table-total-fixed-r"><tbody><tr>'),h.each(function(){i.push(r.children("table:eq(0)").find('[data-key="'+t(this).data("key")+'"]').prop("outerHTML"))}),i.push("<\/tr><\/tbody><\/table>"),r.append(i.join("")))}},fixResizeRightFixed:function(n){var o=this,c=t(n.elem),l=c.next().children(".layui-table-box"),s=l.children(".layui-table-fixed-r").children(".layui-table-header").children("table"),r={},u,f="layui-table-sort",e="layui-table-sort-invalid";if(s.length>0){s.find("th").off("mousemove").on("mousemove",function(n){var u=t(this),e=u.offset().left,f=n.clientX-e;u.data("unresize")||r.resizeStart||(u.width()-f<=10&&i.css("cursor","initial"),r.allowResize=f<=10,i.css("cursor",r.allowResize?"col-resize":""))}).off("mousedown").on("mousedown",function(i){var u=t(this),s;r.allowResize&&(u.find("."+f).removeClass(f).addClass(e),s=u.data("key"),i.preventDefault(),r.resizeStart=!0,r.offset=[i.clientX,i.clientY],o.getCssRule(n,s,function(t){var i=t.style.width||u.outerWidth();r.rule=t;r.ruleWidth=parseFloat(i);r.othis=u;r.minWidth=u.data("minwidth")||n.cellMinWidth}))});h.on("mousemove",function(t){if(r.resizeStart){if(layui.soulTable.fixTableRemember(n,r),t.preventDefault(),r.rule){var i=r.ruleWidth-t.clientX+r.offset[0];i<r.minWidth&&(i=r.minWidth);r.rule.style.width=i+"px"}u=1}}).on("mouseup",function(){r.resizeStart&&setTimeout(function(){r.othis.find("."+e).removeClass(e).addClass(f);i.css("cursor","");r={};o.scrollPatch(n)},30);u===2&&(u=null)})}},fixFixedScroll:function(n){var i=t(n.elem),r=i.next().children(".layui-table-box").children(".layui-table-fixed"),u=i.next().children(".layui-table-box").children(".layui-table-main");r.on("mouseenter",function(){t(this).children(".layui-table-body").addClass("soul-fixed-scroll").on("scroll",function(){var n=t(this).scrollTop();u.scrollTop(n)})}).on("mouseleave",function(){t(this).children(".layui-table-body").removeClass("soul-fixed-scroll").off("scroll")})},scrollPatch:function(n){var r=t(n.elem),a=r.next().children(".layui-table-box").children(".layui-table-header"),v=r.next().children(".layui-table-total"),i=r.next().children(".layui-table-box").children(".layui-table-main"),y=r.next().children(".layui-table-box").children(".layui-table-fixed"),o=r.next().children(".layui-table-box").children(".layui-table-fixed-r"),s=i.children("table"),u=i.width()-i.prop("clientWidth"),h=i.height()-i.prop("clientHeight"),p=s.outerWidth()-i.width(),c=function(n){if(u&&h){if(n=n.eq(0),!n.find(".layui-table-patch")[0]){var i=t('<th class="layui-table-patch"><div class="layui-table-cell"><\/div><\/th>');i.find("div").css({width:u});n.find("tr").append(i)}}else n.find(".layui-table-patch").remove()},l,f;c(a);c(v);l=i.height();f=l-h;y.find(".layui-table-body").css("height",s.height()>=f?f:"auto");o[p>0?"removeClass":"addClass"](e);o.css("right",u-1)},copy:function(n){var t,i;n?(t=document.createElement("div"),t.id="tempTarget",t.style.opacity="0",t.innerText=n,document.body.appendChild(t)):t=document.querySelector("#"+id);try{i=document.createRange();i.selectNode(t);window.getSelection().removeAllRanges();window.getSelection().addRange(i);document.execCommand("copy");window.getSelection().removeAllRanges()}catch(r){console.log("复制失败")}n&&t.parentElement.removeChild(t)},addCSSRule:function(n,t,i,r){"insertRule"in n?n.insertRule(t+"{"+i+"}",r):"addRule"in n&&n.addRule(t,i,r)},deepStringify:function(n){var t={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.stringify(n,function(n,i){return typeof i=="function"?t.PREFIX+i.toString()+t.SUFFIX:i})},deepParse:function(n){var t={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.parse(n,function(n,i){return typeof i=="string"&&i.indexOf(t.SUFFIX)>0&&i.indexOf(t.PREFIX)===0?eval("("+i.replace(t.PREFIX,"").replace(t.SUFFIX,"")+")"):i})||{}},clearFilter:function(n){u.clearFilter(n)},cache:u.cache,deepClone:function(n){var i=Array.isArray(n)?[]:{},t;if(n&&typeof n=="object")for(t in n)n.hasOwnProperty(t)&&(i[t]=n&&typeof n[t]=="object"?this.deepClone(n[t]):n[t]);return i},clearOriginCols:function(n){n?delete f[n]:f={}}};n("soulTable",a)});