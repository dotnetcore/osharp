/**
 @Name：layui.table 表格操作
 @Author：贤心
 @License：MIT
    
 */
layui.define(["laytpl","laypage","layer","form","util"],function(n){"use strict";var t=layui.$,l=layui.laytpl,ut=layui.laypage,o=layui.layer,g=layui.form,wt=layui.util,s=layui.hint(),a=layui.device(),i={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+1e4:0,set:function(n){var i=this;return i.config=t.extend({},i.config,n),i},on:function(n,t){return layui.onevent.call(this,f,n,t)}},u=function(){var n=this,t=n.config,i=t.id||t.index;return i&&(u.that[i]=n,u.config[i]=t),{config:t,reload:function(t){n.reload.call(n,t)},setColsWidth:function(){n.setColsWidth.call(n)},resize:function(){n.resize.call(n)}}},nt=function(n){var t=u.config[n];return t||s.error("The ID option was not found in the table instance"),t||null},h=function(n,i,r,u){var f=n.templet?function(){return typeof n.templet=="function"?n.templet(r):l(t(n.templet).html()||String(i)).render(r)}():i;return u?t("<div>"+f+"<\/div>").text():f},f="table",ft=".layui-table",e="layui-hide",p="layui-none",tt="layui-table-view",et=".layui-table-tool",ot=".layui-table-box",st=".layui-table-init",it=".layui-table-header",w=".layui-table-body",ht=".layui-table-main",ct=".layui-table-fixed",lt=".layui-table-fixed-l",at=".layui-table-fixed-r",vt=".layui-table-total",yt=".layui-table-page",v=".layui-table-sort",y="layui-table-edit",rt="layui-table-hover",b=function(n){return n=n||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return n.fixed&&n.fixed!=="right"?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':n.fixed==="right"?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# var isSort = !(item2.colGroup) && item2.sort; }}",'<th data-field="{{ item2.field||i2 }}" data-key="{{d.index}}-{{i1}}-{{i2}}" {{# if( item2.parentKey){ }}data-parentkey="{{ item2.parentKey }}"{{# } }} {{# if(item2.minWidth){ }}data-minwidth="{{item2.minWidth}}"{{# } }} {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize || item2.colGroup){ }}data-unresize="true"{{# } }} class="{{# if(item2.hide){ }}layui-hide{{# } }}{{# if(isSort){ }} layui-unselect{{# } }}{{# if(!item2.field){ }} layui-table-col-special{{# } }}">','<div class="layui-table-cell laytable-cell-',"{{# if(item2.colGroup){ }}","group","{{# } else { }}","{{d.index}}-{{i1}}-{{i2}}",'{{# if(item2.type !== "normal"){ }}'," laytable-cell-{{ item2.type }}","{{# } }}","{{# } }}",'" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','{{# if(item2.type === "checkbox"){ }}','<input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}>',"{{# } else { }}",'<span>{{item2.title||""}}<\/span>',"{{# if(isSort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc" title="升序"><\/i><i class="layui-edge layui-table-sort-desc" title="降序"><\/i><\/span>',"{{# } }}","{{# } }}","<\/div>","<\/th>",n.fixed?"{{# }; }}":"","{{# }); }}","<\/tr>","{{# }); }}","<\/thead>","<\/table>"].join("")},k='<table cellspacing="0" cellpadding="0" border="0" class="layui-table" {{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}><tbody><\/tbody><\/table>',pt=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" lay-id="{{ d.data.id }}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# if(d.data.toolbar){ }}",'<div class="layui-table-tool">','<div class="layui-table-tool-temp"><\/div>','<div class="layui-table-tool-self"><\/div>',"<\/div>","{{# } }}",'<div class="layui-table-box">',"{{# if(d.data.loading){ }}",'<div class="layui-table-init" style="background-color: #fff;">','<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"><\/i>',"<\/div>","{{# } }}","{{# var left, right; }}",'<div class="layui-table-header">',b(),"<\/div>",'<div class="layui-table-body layui-table-main">',k,"<\/div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',b({fixed:!0}),"<\/div>",'<div class="layui-table-body">',k,"<\/div>","<\/div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',b({fixed:"right"}),'<div class="layui-table-mend"><\/div>',"<\/div>",'<div class="layui-table-body">',k,"<\/div>","<\/div>","{{# }; }}","<\/div>","{{# if(d.data.totalRow){ }}",'<div class="layui-table-total">','<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>','<tbody><tr><td><div class="layui-table-cell" style="visibility: hidden;">Total<\/div><\/td><\/tr><\/tbody>',"<\/table>","<\/div>","{{# } }}","{{# if(d.data.page){ }}",'<div class="layui-table-page">','<div id="layui-table-page{{d.index}}"><\/div>',"<\/div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{i1}}-{{i2}}{ ","{{# if(item2.width){ }}","width: {{item2.width}}px;","{{# } }}"," }","{{# });","}); }}","<\/style>","<\/div>"].join(""),d=t(window),c=t(document),r=function(n){var r=this;r.index=++i.index;r.config=t.extend({},r.config,i.config,n);r.render()};r.prototype.config={limit:10,loading:!0,cellMinWidth:60,defaultToolbar:["filter","exports","print"],autoSort:!0,text:{none:"无数据"}};r.prototype.render=function(){var i=this,n=i.config,u;if(n.elem=t(n.elem),n.where=n.where||{},n.id=n.id||n.elem.attr("id")||i.index,n.request=t.extend({pageName:"page",limitName:"limit"},n.request),n.response=t.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",totalRowName:"totalRow",countName:"count"},n.response),typeof n.page=="object"&&(n.limit=n.page.limit||n.limit,n.limits=n.page.limits||n.limits,i.page=n.page.curr=n.page.curr||1,delete n.page.elem,delete n.page.jump),!n.elem[0])return i;n.height&&/^full-\d+$/.test(n.height)&&(i.fullHeightGap=n.height.split("-")[1],n.height=d.height()-i.fullHeightGap);i.setInit();var f=n.elem,e=f.next("."+tt),r=i.elem=t(l(pt).render({VIEW_CLASS:tt,data:n,index:i.index}));n.index=i.index;i.key=n.id||n.index;e[0]&&e.remove();f.after(r);i.layTool=r.find(et);i.layBox=r.find(ot);i.layHeader=r.find(it);i.layMain=r.find(ht);i.layBody=r.find(w);i.layFixed=r.find(ct);i.layFixLeft=r.find(lt);i.layFixRight=r.find(at);i.layTotal=r.find(vt);i.layPage=r.find(yt);i.renderToolbar();i.fullSize();n.cols.length>1&&(u=i.layFixed.find(it).find("th"),u.height(i.layHeader.height()-1-parseFloat(u.css("padding-top"))-parseFloat(u.css("padding-bottom"))));i.pullData(i.page);i.events()};r.prototype.initOpts=function(n){var t=this,i=t.config;n.checkbox&&(n.type="checkbox");n.space&&(n.type="space");n.type||(n.type="normal");n.type!=="normal"&&(n.unresize=!0,n.width=n.width||{checkbox:48,radio:48,space:15,numbers:40}[n.type])};r.prototype.setInit=function(n){var i=this,t=i.config;if(t.clientWidth=t.width||function(){var n=function(i){var r,u;i=i||t.elem.parent();r=i.width();try{u=i.css("display")==="none"}catch(f){}return i[0]&&(!r||u)?n(i.parent()):r};return n()}(),n==="width")return t.clientWidth;layui.each(t.cols,function(n,r){layui.each(r,function(u,f){if(!f){r.splice(u,1);return}if(f.key=n+"-"+u,f.hide=f.hide||!1,f.colGroup||f.colspan>1){var e=0;layui.each(t.cols[n+1],function(t,i){i.HAS_PARENT||e>1&&e==f.colspan||(i.HAS_PARENT=!0,i.parentKey=n+"-"+u,e=e+parseInt(i.colspan>1?i.colspan:1))});f.colGroup=!0}i.initOpts(f)})})};r.prototype.renderToolbar=function(){var i=this,n=i.config,o='<div class="layui-inline" lay-event="add"><i class="layui-icon layui-icon-add-1"><\/i><\/div><div class="layui-inline" lay-event="update"><i class="layui-icon layui-icon-edit"><\/i><\/div><div class="layui-inline" lay-event="delete"><i class="layui-icon layui-icon-delete"><\/i><\/div>',f=i.layTool.find(".layui-table-tool-temp"),r,e,u;n.toolbar==="default"?f.html(o):typeof n.toolbar=="string"&&(r=t(n.toolbar).html()||"",r&&f.html(l(r).render(n)));e={filter:{title:"筛选列",layEvent:"LAYTABLE_COLS",icon:"layui-icon-cols"},exports:{title:"导出",layEvent:"LAYTABLE_EXPORT",icon:"layui-icon-export"},print:{title:"打印",layEvent:"LAYTABLE_PRINT",icon:"layui-icon-print"}};u=[];typeof n.defaultToolbar=="object"&&layui.each(n.defaultToolbar,function(n,t){var i=typeof t=="string"?e[t]:t;i&&u.push('<div class="layui-inline" title="'+i.title+'" lay-event="'+i.layEvent+'"><i class="layui-icon '+i.icon+'"><\/i><\/div>')});i.layTool.find(".layui-table-tool-self").html(u.join(""))};r.prototype.setParentCol=function(n,t){var u=this,h=u.config,r=u.layHeader.find('th[data-key="'+h.index+"-"+t+'"]'),i=parseInt(r.attr("colspan"))||0,f,o,s;r[0]&&(f=t.split("-"),o=h.cols[f[0]][f[1]],n?i--:i++,r.attr("colspan",i),r[i<1?"addClass":"removeClass"](e),o.colspan=i,o.hide=i<1,s=r.data("parentkey"),s&&u.setParentCol(n,s))};r.prototype.setColsPatch=function(){var n=this,t=n.config;layui.each(t.cols,function(t,i){layui.each(i,function(t,i){i.hide&&n.setParentCol(i.hide,i.parentKey)})})};r.prototype.setColsWidth=function(){var n=this,t=n.config,f=0,r=0,u=0,e=0,i=n.setInit("width"),s,o;if(n.eachCols(function(n,t){t.hide||f++}),i=i-function(){return t.skin==="line"||t.skin==="nob"?2:f+1}()-n.getScrollWidth(n.layMain[0])-1,s=function(n){layui.each(t.cols,function(f,o){layui.each(o,function(f,s){var h=0,c=s.minWidth||t.cellMinWidth;if(!s){o.splice(f,1);return}s.colGroup||s.hide||(n?u&&u<c&&(r--,h=c):(h=s.width||0,/\d+%$/.test(h)?(h=Math.floor(parseFloat(h)/100*i),h<c&&(h=c)):h||(s.width=h=0,r++)),s.hide&&(h=0),e=e+h)})});i>e&&r&&(u=(i-e)/r)},s(),s(!0),n.autoColNums=r,n.eachCols(function(r,f){var e=f.minWidth||t.cellMinWidth;f.colGroup||f.hide||(f.width===0?n.getCssRule(t.index+"-"+f.key,function(n){n.style.width=Math.floor(u>=e?u:e)+"px"}):/\d+%$/.test(f.width)&&n.getCssRule(t.index+"-"+f.key,function(n){n.style.width=Math.floor(parseFloat(f.width)/100*i)+"px"}))}),o=n.layMain.width()-n.getScrollWidth(n.layMain[0])-n.layMain.children("table").outerWidth(),n.autoColNums&&o>=-f&&o<=f){var h=function(t){var i;return(t=t||n.layHeader.eq(0).find("thead th:last-child"),i=t.data("field"),!i&&t.prev()[0])?h(t.prev()):t},c=h(),l=c.data("key");n.getCssRule(l,function(t){var i=t.style.width||c.outerWidth();t.style.width=parseFloat(i)+o+"px";n.layMain.height()-n.layMain.prop("clientHeight")>0&&(t.style.width=parseFloat(t.style.width)-1+"px")})}n.loading(!0)};r.prototype.resize=function(){var n=this;n.fullSize();n.setColsWidth();n.scrollPatch()};r.prototype.reload=function(n){var i=this;n=n||{};delete i.haveInit;n.data&&n.data.constructor===Array&&delete i.config.data;i.config=t.extend(!0,{},i.config,n);i.render()};r.prototype.errorView=function(n){var r=this,u=r.layMain.find("."+p),f=t('<div class="'+p+'">'+(n||"Error")+"<\/div>");u[0]&&(r.layNone.remove(),u.remove());r.layFixed.addClass(e);r.layMain.find("tbody").html("");r.layMain.append(r.layNone=f);i.cache[r.key]=[]};r.prototype.page=1;r.prototype.pullData=function(n){var r=this,i=r.config,s=i.request,u=i.response,h=function(){typeof i.initSort=="object"&&r.sort(i.initSort.field,i.initSort.type)},o,e,f,c;r.startTime=(new Date).getTime();i.url?(o={},o[s.pageName]=n,o[s.limitName]=i.limit,e=t.extend(o,i.where),typeof i.parseParams=="function"&&(e=i.parseParams(e)||e),i.contentType&&i.contentType.indexOf("application/json")==0&&(e=JSON.stringify(e)),r.loading(),t.ajax({type:i.method||"get",url:i.url,contentType:i.contentType,data:e,dataType:"json",headers:i.headers||{},success:function(t){typeof i.parseData=="function"&&(t=i.parseData(t)||t);t[u.statusName]!=u.statusCode?(r.renderForm(),r.errorView(t[u.msgName]||'返回的数据不符合规范，正确的成功状态码应为："'+u.statusName+'": '+u.statusCode)):(r.renderData(t,n,t[u.countName]),h(),i.time=(new Date).getTime()-r.startTime+" ms");r.setColsWidth();typeof i.done=="function"&&i.done(t,n,t[u.countName])},error:function(n,t){r.errorView("数据接口请求异常："+t);r.renderForm();r.setColsWidth()}})):i.data&&i.data.constructor===Array&&(f={},c=n*i.limit-i.limit,f[u.dataName]=i.data.concat().splice(c,i.limit),f[u.countName]=i.data.length,typeof i.totalRow=="object"&&(f[u.totalRowName]=t.extend({},i.totalRow)),r.renderData(f,n,f[u.countName]),h(),r.setColsWidth(),typeof i.done=="function"&&i.done(f,n,f[u.countName]))};r.prototype.eachCols=function(n){var t=this;return i.eachCols(null,n,t.config.cols),t};r.prototype.renderData=function(n,r,u,f){var s=this,c=s.config,a=n[c.response.dataName]||[],k=n[c.response.totalRowName],v=[],y=[],w=[],b=function(){var n;if(!f&&s.sortKey)return s.sort(s.sortKey.field,s.sortKey.sort,!0);layui.each(a,function(u,o){var a=[],p=[],b=[],k=u+c.limit*(r-1)+1;o.length!==0&&(f||(o[i.config.indexName]=u),s.eachCols(function(r,f){var w=f.field||r,y=c.index+"-"+f.key,s=o[w],v;((s===undefined||s===null)&&(s=""),f.colGroup)||(v=['<td data-field="'+w+'" data-key="'+y+'" '+function(){var n=[];return f.edit&&n.push('data-edit="'+f.edit+'"'),f.align&&n.push('align="'+f.align+'"'),f.templet&&n.push('data-content="'+s+'"'),f.toolbar&&n.push('data-off="true"'),f.event&&n.push('lay-event="'+f.event+'"'),f.style&&n.push('style="'+f.style+'"'),f.minWidth&&n.push('data-minwidth="'+f.minWidth+'"'),n.join(" ")}()+' class="'+function(){var n=[];return f.hide&&n.push(e),f.field||n.push("layui-table-col-special"),n.join(" ")}()+'">','<div class="layui-table-cell laytable-cell-'+function(){return f.type==="normal"?y:y+" laytable-cell-"+f.type}()+'">'+function(){var e=t.extend(!0,{LAY_INDEX:k},o),r=i.config.checkName;switch(f.type){case"checkbox":return'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){return f[r]?(o[r]=f[r],f[r]?"checked":""):e[r]?"checked":""}()+">";case"radio":return e[r]&&(n=u),'<input type="radio" name="layTableRadio_'+c.index+'" '+(e[r]?"checked":"")+' lay-type="layTableRadio">';case"numbers":return k}return f.toolbar?l(t(f.toolbar).html()||"").render(e):h(f,s,e)}(),"<\/div><\/td>"].join(""),a.push(v),f.fixed&&f.fixed!=="right"&&p.push(v),f.fixed==="right"&&b.push(v))}),v.push('<tr data-index="'+u+'">'+a.join("")+"<\/tr>"),y.push('<tr data-index="'+u+'">'+p.join("")+"<\/tr>"),w.push('<tr data-index="'+u+'">'+b.join("")+"<\/tr>"))});s.layBody.scrollTop(0);s.layMain.find("."+p).remove();s.layMain.find("tbody").html(v.join(""));s.layFixLeft.find("tbody").html(y.join(""));s.layFixRight.find("tbody").html(w.join(""));s.renderForm();typeof n=="number"&&s.setThisRowChecked(n);s.syncCheckAll();s.haveInit?s.scrollPatch():setTimeout(function(){s.scrollPatch()},50);s.haveInit=!0;o.close(s.tipsIndex);c.HAS_SET_COLS_PATCH||s.setColsPatch();c.HAS_SET_COLS_PATCH=!0};if(i.cache[s.key]=a,s.layPage[u==0||a.length===0&&r==1?"addClass":"removeClass"](e),f)return b();if(a.length===0)return s.renderForm(),s.errorView(c.text.none);s.layFixed.removeClass(e);b();s.renderTotal(a,k);c.page&&(c.page=t.extend({elem:"layui-table-page"+c.index,count:u,limit:c.limit,limits:c.limits||[10,20,30,40,50,60,70,80,90],groups:3,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;<\/i>',next:'<i class="layui-icon">&#xe602;<\/i>',jump:function(n,t){t||(s.page=n.curr,c.limit=n.limit,s.pullData(n.curr))}},c.page),c.page.count=u,ut.render(c.page))};r.prototype.renderTotal=function(n,t){var i=this,r=i.config,u={},f;r.totalRow&&(layui.each(n,function(n,t){t.length!==0&&i.eachCols(function(n,i){var r=i.field||n,f=t[r];i.totalRow&&(u[r]=(u[r]||0)+(parseFloat(f)||0))})}),i.dataTotal={},f=[],i.eachCols(function(n,o){var s=o.field||n,c=function(){var i=o.totalRowText||"",n=parseFloat(u[s]).toFixed(2),r={};return r[s]=n,n=h(o,n,r),t?t[o.field]||i:o.totalRow?n||i:i}(),l=['<td data-field="'+s+'" data-key="'+r.index+"-"+o.key+'" '+function(){var n=[];return o.align&&n.push('align="'+o.align+'"'),o.style&&n.push('style="'+o.style+'"'),o.minWidth&&n.push('data-minwidth="'+o.minWidth+'"'),n.join(" ")}()+' class="'+function(){var n=[];return o.hide&&n.push(e),o.field||n.push("layui-table-col-special"),n.join(" ")}()+'">','<div class="layui-table-cell laytable-cell-'+function(){var n=r.index+"-"+o.key;return o.type==="normal"?n:n+" laytable-cell-"+o.type}()+'">'+c,"<\/div><\/td>"].join("");o.field&&(i.dataTotal[s]=c);f.push(l)}),i.layTotal.find("tbody").html("<tr>"+f.join("")+"<\/tr>"))};r.prototype.getColElem=function(n,t){var i=this,r=i.config;return n.eq(0).find(".laytable-cell-"+(r.index+"-"+t)+":eq(0)")};r.prototype.renderForm=function(n){g.render(n,"LAY-table-"+this.index)};r.prototype.setThisRowChecked=function(n){var t=this,u=t.config,i="layui-table-click",r=t.layBody.find('tr[data-index="'+n+'"]');r.addClass(i).siblings("tr").removeClass(i)};r.prototype.sort=function(n,r,u,e){var o=this,y={},a=o.config,b=a.elem.attr("lay-filter"),c=i.cache[o.key],l,h,p,w;typeof n=="string"&&o.layHeader.find("th").each(function(){var i=t(this),r=i.data("field");if(r===n)return n=i,h=r,!1});try{if(h=h||n.data("field"),p=n.data("key"),o.sortKey&&!u&&h===o.sortKey.field&&r===o.sortKey.sort)return;w=o.layHeader.find("th .laytable-cell-"+p).find(v);o.layHeader.find("th").find(v).removeAttr("lay-sort");w.attr("lay-sort",r||null);o.layFixed.find("th")}catch(k){return s.error("Table modules: Did not match to field")}o.sortKey={field:h,sort:r};a.autoSort&&(r==="asc"?l=layui.sort(c,h):r==="desc"?l=layui.sort(c,h,!0):(l=layui.sort(c,i.config.indexName),delete o.sortKey));y[a.response.dataName]=l||c;o.renderData(y,o.page,o.count,!0);e&&layui.event.call(n,f,"sort("+b+")",{field:h,type:r})};r.prototype.loading=function(n){var i=this,r=i.config;r.loading&&(n?(i.layInit&&i.layInit.remove(),delete i.layInit,i.layBox.find(st).remove()):(i.layInit=t('<div class="layui-table-init"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"><\/i><\/div>'),i.layBox.append(i.layInit)))};r.prototype.setCheckData=function(n,t){var u=this,f=u.config,r=i.cache[u.key];r[n]&&r[n].constructor!==Array&&(r[n][f.checkName]=t)};r.prototype.syncCheckAll=function(){var n=this,u=n.config,t=n.layHeader.find('input[name="layTableCheckbox"]'),r=function(t){return n.eachCols(function(n,i){i.type==="checkbox"&&(i[u.checkName]=t)}),t};t[0]&&(i.checkStatus(n.key).isAll?(t[0].checked||(t.prop("checked",!0),n.renderForm("checkbox")),r(!0)):(t[0].checked&&(t.prop("checked",!1),n.renderForm("checkbox")),r(!1)))};r.prototype.getCssRule=function(n,t){var u=this,i=u.elem.find("style")[0],r=i.sheet||i.styleSheet||{},f=r.cssRules||r.rules;layui.each(f,function(i,r){if(r.selectorText===".laytable-cell-"+n)return t(r),!0})};r.prototype.fullSize=function(){var n=this,r=n.config,i=r.height,t;(n.fullHeightGap&&(i=d.height()-n.fullHeightGap,i<135&&(i=135),n.elem.css("height",i)),i)&&(t=parseFloat(i)-(n.layHeader.outerHeight()||38),r.toolbar&&(t=t-(n.layTool.outerHeight()||50)),r.totalRow&&(t=t-(n.layTotal.outerHeight()||40)),r.page&&(t=t-(n.layPage.outerHeight()||41)),n.layMain.css("height",t-2))};r.prototype.getScrollWidth=function(n){var t=0;return n?t=n.offsetWidth-n.clientWidth:(n=document.createElement("div"),n.style.width="100px",n.style.height="100px",n.style.overflowY="scroll",document.body.appendChild(n),t=n.offsetWidth-n.clientWidth,document.body.removeChild(n)),t};r.prototype.scrollPatch=function(){var n=this,u=n.layMain.children("table"),i=n.layMain.width()-n.layMain.prop("clientWidth"),f=n.layMain.height()-n.layMain.prop("clientHeight"),c=n.getScrollWidth(n.layMain[0]),h=u.outerWidth()-n.layMain.width(),o=function(n){if(i&&f){if(n=n.eq(0),!n.find(".layui-table-patch")[0]){var r=t('<th class="layui-table-patch"><div class="layui-table-cell"><\/div><\/th>');r.find("div").css({width:i});n.find("tr").append(r)}}else n.find(".layui-table-patch").remove()},s,r;o(n.layHeader);o(n.layTotal);s=n.layMain.height();r=s-f;n.layFixed.find(w).css("height",u.height()>=r?r:"auto");n.layFixRight[h>0?"removeClass":"addClass"](e);n.layFixRight.css("right",i-1)};r.prototype.events=function(){var n=this,u=n.config,k=t("body"),r={},it=n.layHeader.find("th"),p,b=".layui-table-cell",s=u.elem.attr("lay-filter"),l,nt;n.layTool.on("click","*[lay-event]",function(r){var v=t(this),y=v.attr("lay-event"),p=function(i){var f=t(i.list),r=t('<ul class="layui-table-tool-panel"><\/ul>');r.html(f);u.height&&r.css("max-height",u.height-(n.layTool.outerHeight()||50));v.find(".layui-table-tool-panel")[0]||v.append(r);n.renderForm();r.on("click",function(n){layui.stope(n)});i.done&&i.done(r,f)};layui.stope(r);c.trigger("table.tool.panel.remove");o.close(n.tipsIndex);switch(y){case"LAYTABLE_COLS":p({list:function(){var t=[];return n.eachCols(function(n,i){i.field&&i.type=="normal"&&t.push('<li><input type="checkbox" name="'+i.field+'" data-key="'+i.key+'" data-parentkey="'+(i.parentKey||"")+'" lay-skin="primary" '+(i.hide?"":"checked")+' title="'+(i.title||i.field)+'" lay-filter="LAY_TABLE_TOOL_COLS"><\/li>')}),t.join("")}(),done:function(){g.on("checkbox(LAY_TABLE_TOOL_COLS)",function(i){var f=t(i.elem),r=this.checked,o=f.data("key"),s=f.data("parentkey");layui.each(u.cols,function(t,i){layui.each(i,function(i,f){if(t+"-"+i===o){var h=f.hide;f.hide=!r;n.elem.find('*[data-key="'+u.index+"-"+o+'"]')[r?"removeClass":"addClass"](e);h!=f.hide&&n.setParentCol(!r,s);n.resize()}})})})}});break;case"LAYTABLE_EXPORT":a.ie?o.tips("导出功能不支持 IE，请用 Chrome 等高级浏览器导出",this,{tips:3}):p({list:function(){return'<li data-type="csv">导出到 Csv 文件<\/li><li data-type="xls">导出到 Excel 文件<\/li>'}(),done:function(r,f){f.on("click",function(){var r=t(this).data("type");i.exportFile.call(n,u.id,null,r)})}});break;case"LAYTABLE_PRINT":var l=window.open("打印窗口","_blank"),w="<style>body{font-size: 12px; color: #666;}table{width: 100%; border-collapse: collapse; border-spacing: 0;}th,td{line-height: 20px; padding: 9px 15px; border: 1px solid #ccc; text-align: left; font-size: 12px; color: #666;}a{color: #666; text-decoration:none;}*.layui-hide{display: none}<\/style>",h=t(n.layHeader.html());h.append(n.layMain.find("table").html());h.append(n.layTotal.find("table").html());h.find("th.layui-table-patch").remove();h.find(".layui-table-col-special").remove();l.document.write(w+h.prop("outerHTML"));l.document.close();l.print();l.close()}layui.event.call(this,f,"toolbar("+s+")",t.extend({event:y,config:u},{}))});it.on("mousemove",function(n){var i=t(this),u=i.offset().left,f=n.clientX-u;i.data("unresize")||r.resizeStart||(r.allowResize=i.width()-f<=10,k.css("cursor",r.allowResize?"col-resize":""))}).on("mouseleave",function(){var n=t(this);r.resizeStart||k.css("cursor","")}).on("mousedown",function(i){var f=t(this),e;r.allowResize&&(e=f.data("key"),i.preventDefault(),r.resizeStart=!0,r.offset=[i.clientX,i.clientY],n.getCssRule(e,function(n){var t=n.style.width||f.outerWidth();r.rule=n;r.ruleWidth=parseFloat(t);r.minWidth=f.data("minwidth")||u.cellMinWidth}))});c.on("mousemove",function(t){if(r.resizeStart){if(t.preventDefault(),r.rule){var i=r.ruleWidth+t.clientX-r.offset[0];i<r.minWidth&&(i=r.minWidth);r.rule.style.width=i+"px";o.close(n.tipsIndex)}p=1}}).on("mouseup",function(){r.resizeStart&&(r={},k.css("cursor",""),n.scrollPatch());p===2&&(p=null)});it.on("click",function(){var i=t(this),r=i.find(v),u=r.attr("lay-sort"),f;if(!r[0]||p===1)return p=2;f=u==="asc"?"desc":u==="desc"?null:"asc";n.sort(i,f,null,!0)}).find(v+" .layui-edge ").on("click",function(i){var r=t(this),f=r.index(),u=r.parents("th").eq(0).data("field");layui.stope(i);f===0?n.sort(u,"asc",null,!0):n.sort(u,"desc",null,!0)});l=function(r){var o=t(this),f=o.parents("tr").eq(0).data("index"),e=n.layBody.find('tr[data-index="'+f+'"]'),u=i.cache[n.key]||[];return u=u[f]||{},t.extend({tr:e,data:i.clearCacheKey(u),del:function(){i.cache[n.key][f]=[];e.remove();n.scrollPatch()},update:function(t){t=t||{};layui.each(t,function(t,i){if(t in u){var r,f=e.children('td[data-field="'+t+'"]');u[t]=i;n.eachCols(function(n,i){i.field==t&&i.templet&&(r=i.templet)});f.children(b).html(h({templet:r},i,u));f.data("content",i)}})}},r)};n.elem.on("click",'input[name="layTableCheckbox"]+',function(){var i=t(this).prev(),e=n.layBody.find('input[name="layTableCheckbox"]'),o=i.parents("tr").eq(0).data("index"),r=i[0].checked,u=i.attr("lay-filter")==="layTableAllChoose";u?(e.each(function(t,i){i.checked=r;n.setCheckData(t,r)}),n.syncCheckAll(),n.renderForm("checkbox")):(n.setCheckData(o,r),n.syncCheckAll());layui.event.call(i[0],f,"checkbox("+s+")",l.call(i[0],{checked:r,type:u?"all":"one"}))});n.elem.on("click",'input[lay-type="layTableRadio"]+',function(){var r=t(this).prev(),e=r[0].checked,o=i.cache[n.key],u=r.parents("tr").eq(0).data("index");layui.each(o,function(n,t){u===n?t.LAY_CHECKED=!0:delete t.LAY_CHECKED});n.setThisRowChecked(u);layui.event.call(this,f,"radio("+s+")",l.call(this,{checked:e}))});n.layBody.on("mouseenter","tr",function(){var i=t(this),r=i.index();i.data("off")||n.layBody.find("tr:eq("+r+")").addClass(rt)}).on("mouseleave","tr",function(){var i=t(this),r=i.index();i.data("off")||n.layBody.find("tr:eq("+r+")").removeClass(rt)}).on("click","tr",function(){nt.call(this,"row")}).on("dblclick","tr",function(){nt.call(this,"rowDouble")});nt=function(n){var i=t(this);i.data("off")||layui.event.call(this,f,n+"("+s+")",l.call(i.children("td")[0]))};n.layBody.on("change","."+y,function(){var r=t(this),u=this.value,e=r.parent().data("field"),o=r.parents("tr").eq(0).data("index"),h=i.cache[n.key][o];h[e]=u;layui.event.call(this,f,"edit("+s+")",l.call(this,{value:u,field:e}))}).on("blur","."+y,function(){var u,r=t(this),f=this,e=r.parent().data("field"),o=r.parents("tr").eq(0).data("index"),s=i.cache[n.key][o];n.eachCols(function(n,t){t.field==e&&t.templet&&(u=t.templet)});r.siblings(b).html(function(n){return h({templet:u},n,s)}(f.value));r.parent().data("content",f.value);r.remove()});n.layBody.on("click","td",function(n){var i=t(this),e=i.data("field"),u=i.data("edit"),f=i.children(b),r;if(!i.data("off")&&u){r=t('<input class="layui-input '+y+'">');r[0].value=i.data("content")||f.text();i.find("."+y)[0]||i.append(r);r.focus();layui.stope(n);return}}).on("mouseenter","td",function(){ut.call(this)}).on("mouseleave","td",function(){ut.call(this,"hide")});var tt="layui-table-grid-down",ut=function(n){var i=t(this),r=i.children(b);if(!i.data("off"))if(n)i.find(".layui-table-grid-down").remove();else if(r.prop("scrollWidth")>r.outerWidth()){if(r.find("."+tt)[0])return;i.append('<div class="'+tt+'"><i class="layui-icon layui-icon-down"><\/i><\/div>')}};n.layBody.on("click","."+tt,function(i){var f=t(this),e=f.parent(),r=e.children(b);n.tipsIndex=o.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(r.height()+16)+"px;"+function(){return u.size==="sm"?"padding: 4px 15px; font-size: 12px;":u.size==="lg"?"padding: 14px 15px;":""}()+'">',r.html(),"<\/div>",'<i class="layui-icon layui-table-tips-c layui-icon-close"><\/i>'].join(""),r[0],{tips:[3,""],time:-1,anim:-1,maxWidth:a.ios||a.android?300:n.elem.width()/2,isOutAnim:!1,skin:"layui-table-tips",success:function(n,t){n.find(".layui-table-tips-c").on("click",function(){o.close(t)})}});layui.stope(i)});n.layBody.on("click","*[lay-event]",function(){var i=t(this),r=i.parents("tr").eq(0).data("index");layui.event.call(this,f,"tool("+s+")",l.call(this,{event:i.attr("lay-event")}));n.setThisRowChecked(r)});n.layMain.on("scroll",function(){var i=t(this),r=i.scrollLeft(),u=i.scrollTop();n.layHeader.scrollLeft(r);n.layTotal.scrollLeft(r);n.layFixed.find(w).scrollTop(u);o.close(n.tipsIndex)});d.on("resize",function(){n.resize()})},function(){c.on("click",function(){c.trigger("table.remove.tool.panel")});c.on("table.remove.tool.panel",function(){t(".layui-table-tool-panel").remove()})}();i.init=function(n,r){r=r||{};var f=this,e=n?t('table[lay-filter="'+n+'"]'):t(ft+"[lay-data]"),u="Table element property lay-data configuration item has a syntax error: ";return e.each(function(){var f=t(this),o=f.attr("lay-data"),h,e;try{o=new Function("return "+o)()}catch(c){s.error(u+o)}h=[];e=t.extend({elem:this,cols:[],data:[],skin:f.attr("lay-skin"),size:f.attr("lay-size"),even:typeof f.attr("lay-even")=="string"},i.config,r,o);n&&f.hide();f.find("thead>tr").each(function(n){e.cols[n]=[];t(this).children().each(function(){var i=t(this),r=i.attr("lay-data"),f;try{r=new Function("return "+r)()}catch(o){return s.error(u+r)}f=t.extend({title:i.text(),colspan:i.attr("colspan")||0,rowspan:i.attr("rowspan")||0},r);f.colspan<2&&h.push(f);e.cols[n].push(f)})});f.find("tbody>tr").each(function(n){var r=t(this),i={};r.children("td").each(function(){var n=t(this),r=n.data("field");if(r)return i[r]=n.html()});layui.each(h,function(n,t){var u=r.children("td").eq(n);i[t.field]=u.html()});e.data[n]=i});i.render(e)}),f};u.that={};u.config={};i.eachCols=function(n,i,r){var s=u.config[n]||{},e=[],o=0,f;r=t.extend(!0,[],r||s.cols);layui.each(r,function(n,t){layui.each(t,function(t,i){if(i.colGroup){var u=0;o++;i.CHILD_COLS=[];layui.each(r[n+1],function(n,t){t.PARENT_COL_INDEX||u>1&&u==i.colspan||(t.PARENT_COL_INDEX=o,i.CHILD_COLS.push(t),u=u+parseInt(t.colspan>1?t.colspan:1))})}i.PARENT_COL_INDEX||e.push(i)})});f=function(n){layui.each(n||e,function(n,t){if(t.CHILD_COLS)return f(t.CHILD_COLS);typeof i=="function"&&i(n,t)})};f()};i.checkStatus=function(n){var r=0,u=0,f=[],t=i.cache[n]||[];return layui.each(t,function(n,t){if(t.constructor===Array){u++;return}t[i.config.checkName]&&(r++,f.push(i.clearCacheKey(t)))}),{data:f,isAll:t.length?r===t.length-u:!1}};i.exportFile=function(n,t,r){var o=this;t=t||i.clearCacheKey(i.cache[n]);r=r||"csv";var e=u.config[n]||{},c={csv:"text/csv",xls:"application/vnd.ms-excel"}[r],f=document.createElement("a");if(a.ie)return s.error("IE_NOT_SUPPORT_EXPORTS");f.href="data:"+c+";charset=utf-8,﻿"+encodeURIComponent(function(){var r=[],u=[],f=[];return layui.each(t,function(t,f){var e=[];typeof n=="object"?(layui.each(n,function(n,i){t==0&&r.push(i||"")}),layui.each(i.clearCacheKey(f),function(n,t){e.push('"'+(t||"")+'"')})):i.eachCols(n,function(n,i){if(i.field&&i.type=="normal"&&!i.hide){var u=f[i.field];(u===undefined||u===null)&&(u="");t==0&&r.push(i.title||"");e.push('"'+h(i,u,f,"text")+'"')}});u.push(e.join(","))}),layui.each(o.dataTotal,function(n,t){f.push(t)}),r.join(",")+"\r\n"+u.join("\r\n")+"\r\n"+f.join(",")}());f.download=(e.title||"table_"+(e.index||""))+"."+r;document.body.appendChild(f);f.click();document.body.removeChild(f)};i.resize=function(n){if(n){var t=nt(n);if(!t)return;u.that[n].resize()}else layui.each(u.that,function(){this.resize()})};i.reload=function(n,t){var r=nt(n),i;if(r)return i=u.that[n],i.reload(t),u.call(i)};i.render=function(n){var t=new r(n);return u.call(t)};i.clearCacheKey=function(n){return n=t.extend({},n),delete n[i.config.checkName],delete n[i.config.indexName],n};i.init();n(f,i)});